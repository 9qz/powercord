/**
 * Copyright (c) 2018-2020 aetheryx & Bowser65
 * All Rights Reserved. Licensed under the Porkord License
 * https://powercord.dev/porkord-license
 */

const { React, getModule } = require('powercord/webpack');
const AsyncComponent = require('./AsyncComponent');

// Thanks to Juby210#0577 for pointing this out
const Icon = AsyncComponent.from((async () => {
  const registry = await getModule(m => m.id && typeof m.keys === 'function' && m.keys().includes('./Activity'));
  Icon.Names = registry.keys()
    .filter(k => !k.endsWith('.tsx') && !k.endsWith('.css') && !k.startsWith('./addDefaultIconProps'))
    .map(m => m.substring(2));

  return (props) => {
    const mdl = registry(props.name);
    const newProps = global._.cloneDeep(props);
    delete newProps.name;

    React.createElement(mdl.default, newProps);
  };
})());

module.exports = Icon;
