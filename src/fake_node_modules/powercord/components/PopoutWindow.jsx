/**
 * Powercord, a lightweight @discord client mod focused on simplicity and performance
 * Copyright (C) 2018-2020  aetheryx & Bowser65
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

const { getModuleByDisplayName } = require('powercord/webpack');
const AsyncComponent = require('./AsyncComponent');

module.exports = AsyncComponent.from((async () => {
  const DiscordPopoutWindow = await getModuleByDisplayName('FluxContainer(PopoutWindow)');
  class PopoutWindow extends DiscordPopoutWindow {
    constructor (props) {
      if (!props.withTitleBar) {
        // Enforce it
        props.withTitleBar = false;
      }
      super(props);
    }

    componentDidMount () {
      super.componentDidMount();
      const store = this.listener.stores.find(s => s.getWindow);
      const guestWindow = store.getWindow(this.props.windowKey);
      document.querySelectorAll('style[data-powercord]').forEach(style => {
        guestWindow.document.head.innerHTML += style.outerHTML;
      });
    }
  }

  return PopoutWindow;
})());
